<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="language" content="english">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="content-type" content="text/html">
  <meta name="author" content="Yoogottam Khandelwal">
  <meta name="designer" content="Yoogottam Khandelwal">

  
    <meta property="og:title" content="AoC 2021 in bash">
    <meta property="og:image" content="https://yoogottamk.github.io/assets/images/posts/aoc-bash.webp">
    <meta property="og:description" content="I feel AoC is a nice way to get to know the language of your choice. There's string manipulation, basic mathematics and more. bash isn't the ideal language for this...">
  
  
  

  <meta property="og:url" content="https://yoogottamk.github.io/blog/aoc-2021-bash">

  <title>Aoc 2021 Bash | yoogottamk</title>

  <!-- bootstrap css -->

<link rel="stylesheet"
  href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
  integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
  crossorigin="anonymous" />

<link rel="stylesheet"
  href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
  integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
  crossorigin="anonymous" />

<!-- fonts, included only where required to reduce load time -->

  
    
      <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald&display=swap" rel="stylesheet" />
    
  

  

  


<!-- fonts to be loaded on all pages are here -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato&display=swap" />


  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="/css/copy-code.css">
  <link rel="shortcut icon" href="/assets/images/yoogottamk.webp" type="image/x-icon" />
</head>

<body>
  <div class="content">
    <!-- custom css for managing navbar -->
<link rel="stylesheet" href="/css/navbar.css" />
<script src="/js/navbar.js"></script>

<nav id="navbar" class="navbar navbar-expand-lg navbar-dark fixed-top">
  <button class="navbar-toggler" type="button" data-toggle="modal" data-target="#navbarContentSmall" aria-label="Show/hide navbar">
    <span class="navbar-toggler-icon"></span>
  </button>

  <a class="navbar-brand" href="/">
    <img src="/assets/images/yoogottamk.webp" alt="yk logo" width="30" height="30">
    yoogottamk
  </a>

  <div class="collapse navbar-collapse" id="navbarContent">
    <ul class="navbar-nav ml-auto">
      
      
        <li class="nav-item">
          <a class="nav-link active" href="/blog/">
            <i class="fa fa-pencil-square nav-icon align-middle" aria-hidden="true"></i>
            <span class="align-middle">My blog</span>
          </a>
          <div class="nav-desc">My experiences with vim, GNU plus linux and other cool stuff</div>
        </li>
      
        <li class="nav-item">
          <a class="nav-link " href="/projects/">
            <i class="fa fa-flash nav-icon align-middle" aria-hidden="true"></i>
            <span class="align-middle">My projects</span>
          </a>
          <div class="nav-desc">Some stuff that I did in the small time I managed to get</div>
        </li>
      
        <li class="nav-item">
          <a class="nav-link " href="/snippets/">
            <i class="fa fa-code nav-icon align-middle" aria-hidden="true"></i>
            <span class="align-middle">Snippets</span>
          </a>
          <div class="nav-desc">Cool random code snippets</div>
        </li>
      
        <li class="nav-item">
          <a class="nav-link " href="/about/">
            <i class="fa fa-info-circle nav-icon align-middle" aria-hidden="true"></i>
            <span class="align-middle">About me</span>
          </a>
          <div class="nav-desc">Want to know more about me?</div>
        </li>
      
    </ul>
  </div>
</nav>

<div class="modal left fade" id="navbarContentSmall" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5>yoogottamk</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
        <ul class="navbar-nav ml-auto">
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="fa fa-pencil-square nav-icon align-middle" aria-hidden="true"></i>
                My blog
              </a>
              <div class="nav-desc">My experiences with vim, GNU plus linux and other cool stuff</div>
            </li>
            <hr>
          
            <li class="nav-item">
              <a class="nav-link" href="/projects/">
                <i class="fa fa-flash nav-icon align-middle" aria-hidden="true"></i>
                My projects
              </a>
              <div class="nav-desc">Some stuff that I did in the small time I managed to get</div>
            </li>
            <hr>
          
            <li class="nav-item">
              <a class="nav-link" href="/snippets/">
                <i class="fa fa-code nav-icon align-middle" aria-hidden="true"></i>
                Snippets
              </a>
              <div class="nav-desc">Cool random code snippets</div>
            </li>
            <hr>
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="fa fa-info-circle nav-icon align-middle" aria-hidden="true"></i>
                About me
              </a>
              <div class="nav-desc">Want to know more about me?</div>
            </li>
            <hr>
          
        </ul>
      </div>
    </div>
  </div>
</div>


    <link rel="stylesheet" href="/css/post.css">
<link rel="stylesheet" href="/css/syntax.css">

<div class="jumbotron jumbotron-fluid"
   style="background-image: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 1)), url(/assets/images/posts/aoc-bash.webp);">
  <div class="container">
    <h1>AoC 2021 in bash</h1>
    December 05, 2021
  </div>
</div>

<div class="container" id="post-body">
  <p>I feel <a href="https://adventofcode.com/" target="_blank" rel="noopener">AoC</a> is a nice way to get to know the language of your choice. There's string manipulation, basic mathematics and more. <code class="highlighter-rouge">bash</code> isn't the ideal language for this task because (in my opinion) it wasn't meant to solve these kind of problems. Nevertheless, I wanted to expand my experience with <code class="highlighter-rouge">bash</code> and so I'll attempt to solve all the AoC problems using this language.</p>

<p>I might not be able to solve the problems on the same day (heck, I'm starting almost a week late) and might even skip some problems altogether. I also plan to use common tools like <code class="highlighter-rouge">grep</code>, <code class="highlighter-rouge">sed</code>, <code class="highlighter-rouge">awk</code>, etc and not rely on pure bash.</p>

<h1 class="section-header">Index</h1>
<ul>
  <li>Day 01 <a href="#d01p1">part 1</a> <a href="#d01p2">part 2</a></li>
  <li>Day 02 <a href="#d02p1">part 1</a> <a href="#d02p2">part 2</a></li>
  <li>Day 03 <a href="#d03p1">part 1</a> <a href="#d03p2">part 2</a></li>
  <li>Day 04 <a href="#d04p1">part 1</a> <a href="#d04p2">part 2</a></li>
  <li>Day 05 <a href="#d05p1">part 1</a> <a href="#d05p2">part 2</a></li>
</ul>

<div class="text-center py-4">· · ·</div>

<h1 class="section-header">Day 01</h1>

<h2 class="section-header pt-4" id="d01p1">Part 1</h2>
<p>First, let's get the first value and setup variables</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">prev_value</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">head</span> <span class="nt">-1</span> <span class="nv">$INP_FILE</span><span class="si">)</span><span class="s2">"</span>
<span class="c"># keep count in this variable</span>
<span class="nv">inc_count</span><span class="o">=</span>0
<span class="c"># store input file in a variable</span>
<span class="nv">INP_FILE</span><span class="o">=</span><span class="s2">"../inp/1"</span>
</code></pre></div></div>

<p>Now, skipping the first line, we need to iterate over the rest and count the changes</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'2,$p'</span> <span class="s2">"</span><span class="nv">$INP_FILE</span><span class="s2">"</span> | <span class="k">while </span><span class="nb">read </span>value<span class="p">;</span> <span class="k">do</span>
    <span class="o">((</span> value <span class="o">&gt;</span> prev_value <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="o">((</span> inc_count++ <span class="o">))</span>
    <span class="nv">prev_value</span><span class="o">=</span><span class="nv">$value</span>
<span class="k">done</span>
</code></pre></div></div>

<p>Finally, lets print the answer</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="nv">$inc_count</span>
<span class="c"># Output:</span>
0
</code></pre></div></div>

<p><code class="highlighter-rouge">WRONG ANSWER</code>. Umm… what?! After opening the file and confirming that the answer indeed isn't 0, I decided to do some print debugging…</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'2,$p'</span> <span class="s2">"</span><span class="nv">$INP_FILE</span><span class="s2">"</span> | <span class="k">while </span><span class="nb">read </span>value<span class="p">;</span> <span class="k">do</span>
    <span class="o">((</span> value <span class="o">&gt;</span> prev_value <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="o">((</span> inc_count++ <span class="o">))</span>
    <span class="nb">echo</span> <span class="nv">$inc_count</span>
    <span class="nv">prev_value</span><span class="o">=</span><span class="nv">$value</span>
<span class="k">done</span>
</code></pre></div></div>
<p>…and surely, non zero values were being printed:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
1398
1399
1400
1400
</code></pre></div></div>
<p><a href="https://stackoverflow.com/q/4667509" target="_blank" rel="noopener">This</a> confirmed my doubt that the piped <code class="highlighter-rouge">while</code> loop was actually running inside a subshell.</p>

<p>A fix, also mentioned in the post was to wrap the <code class="highlighter-rouge">while</code> loop and <code class="highlighter-rouge">echo</code> inside braces to make it be processed by the same subshell.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'2,$p'</span> <span class="s2">"</span><span class="nv">$INP_FILE</span><span class="s2">"</span> | <span class="o">{</span>
    <span class="k">while </span><span class="nb">read </span>value<span class="p">;</span> <span class="k">do</span>
        <span class="o">((</span> value <span class="o">&gt;</span> prev_value <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="o">((</span> inc_count++ <span class="o">))</span>
        <span class="nv">prev_value</span><span class="o">=</span><span class="nv">$value</span>
    <span class="k">done
    </span><span class="nb">echo</span> <span class="nv">$inc_count</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note that the variable originally declared outside is still 0.</p>

<h2 class="section-header pt-4" id="d01p2">Part 2</h2>
<p>Firstly, I'll make a function, <code class="highlighter-rouge">part1</code> that solves part 1. It'll accept a single argument: a filename which has the numbers</p>

<p>We're going to use <code class="highlighter-rouge">paste</code> and <a href="https://tldp.org/LDP/abs/html/process-sub.html" rel="noopener" target="_blank">process substitution</a> to calculate the window sum.</p>

<p>A little bit of background first: we want to offset the stream of numbers and want to see them side by side, very much like the illustration provided on the website:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>199  A
200  A B
208  A B C
210    B C D
200  E   C D
207  E F   D
240  E F G
269    F G H
260      G H
263        H
</code></pre></div></div>

<p>Using paste, we can merge two numbers from the lines together:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">paste</span> &lt;<span class="o">(</span><span class="nb">seq </span>1 5<span class="o">)</span> &lt;<span class="o">(</span><span class="nb">seq </span>1 5<span class="o">)</span>

<span class="c"># Output:</span>
1	1
2	2
3	3
4	4
5	5
</code></pre></div></div>

<p>We can achieve the offset simply by using <code class="highlighter-rouge">echo</code>. Also, changing delimiter to +</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">paste</span> <span class="nt">-d</span>+ &lt;<span class="o">(</span><span class="nb">seq </span>1 5<span class="o">)</span> &lt;<span class="o">(</span><span class="nb">echo</span><span class="p">;</span> <span class="nb">seq </span>1 5<span class="o">)</span>

<span class="c"># Output:</span>
1+
2+1
3+2
4+3
5+4
+5
</code></pre></div></div>

<p>Passing this to <code class="highlighter-rouge">bc</code> will give us the sum for valid windows and print <code class="highlighter-rouge">(standard_in) [NUMBER]: syntax error</code> to stderr, which will get ignored anyways ;)</p>

<p>Putting it all together:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">tmpfile</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">mktemp</span><span class="si">)</span><span class="s2">"</span>

<span class="c"># calculate sum of 3-interval window</span>
<span class="c"># NOTE: numbers not part of a window will get ignored anyways</span>
<span class="nb">paste</span> <span class="nt">-d</span>+ <span class="s2">"</span><span class="nv">$INP_FILE</span><span class="s2">"</span> &lt;<span class="o">(</span><span class="nb">echo</span><span class="p">;</span> <span class="nb">cat</span> <span class="s2">"</span><span class="nv">$INP_FILE</span><span class="s2">"</span><span class="o">)</span> &lt;<span class="o">(</span><span class="nb">echo</span><span class="p">;</span> <span class="nb">echo</span><span class="p">;</span> <span class="nb">cat</span> <span class="s2">"</span><span class="nv">$INP_FILE</span><span class="s2">"</span><span class="o">)</span> | bc <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$tmpfile</span><span class="s2">"</span> 2&gt;/dev/null

part1 <span class="s2">"</span><span class="nv">$tmpfile</span><span class="s2">"</span>

<span class="nb">rm</span> <span class="s2">"</span><span class="nv">$tmpfile</span><span class="s2">"</span>
</code></pre></div></div>

<div class="text-center py-4">· · ·</div>

<h1 class="section-header">Day 02</h1>

<p>There was nothing surprising or special about my solution for Day 02 so I'll just put them here:</p>

<h2 class="section-header pt-4" id="d02p1">Part 1</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>part1 <span class="o">{</span>
    <span class="nv">horizontal</span><span class="o">=</span>0
    <span class="nv">depth</span><span class="o">=</span>0

    <span class="k">while </span><span class="nb">read </span>directive value<span class="p">;</span> <span class="k">do
        case</span> <span class="nv">$directive</span> <span class="k">in
            </span>forward<span class="p">)</span>
                <span class="o">((</span> horizontal +<span class="o">=</span> value <span class="o">))</span>
                <span class="p">;;</span>
            down<span class="p">)</span>
                <span class="o">((</span> depth +<span class="o">=</span> value <span class="o">))</span>
                <span class="p">;;</span>
            up<span class="p">)</span>
                <span class="o">((</span> depth -<span class="o">=</span> value <span class="o">))</span>
                <span class="p">;;</span>
        <span class="k">esac</span>
    <span class="k">done</span> &lt; <span class="s2">"</span><span class="nv">$INP_FILE</span><span class="s2">"</span>

    <span class="nb">echo</span> <span class="k">$((</span> horizontal <span class="o">*</span> depth <span class="k">))</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 class="section-header pt-4" id="d02p2">Part 2</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>part2 <span class="o">{</span>
    <span class="nv">horizontal</span><span class="o">=</span>0
    <span class="nv">depth</span><span class="o">=</span>0
    <span class="nv">aim</span><span class="o">=</span>0

    <span class="k">while </span><span class="nb">read </span>directive value<span class="p">;</span> <span class="k">do
        case</span> <span class="nv">$directive</span> <span class="k">in
            </span>forward<span class="p">)</span>
                <span class="o">((</span> horizontal +<span class="o">=</span> value <span class="o">))</span>
                <span class="o">((</span> depth +<span class="o">=</span> value <span class="k">*</span> aim <span class="o">))</span>
                <span class="p">;;</span>
            down<span class="p">)</span>
                <span class="o">((</span> aim +<span class="o">=</span> value <span class="o">))</span>
                <span class="p">;;</span>
            up<span class="p">)</span>
                <span class="o">((</span> aim -<span class="o">=</span> value <span class="o">))</span>
                <span class="p">;;</span>
        <span class="k">esac</span>
    <span class="k">done</span> &lt; <span class="s2">"</span><span class="nv">$INP_FILE</span><span class="s2">"</span>

    <span class="nb">echo</span> <span class="k">$((</span> horizontal <span class="o">*</span> depth <span class="k">))</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="text-center py-4">· · ·</div>

<h1 class="section-header">Day 03</h1>

<h2 class="section-header pt-4" id="d03p1">Part 1</h2>
<p>First, I'll define a few global variables that'll come handy in the solution. <code class="highlighter-rouge">INP_FILE</code>, like all other solutions and <code class="highlighter-rouge">N_COLS</code>.
Since the number of columns in each line is fixed, we can simply check the characters in the first line and remove 1 for the newline character.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># this counts the newline too</span>
<span class="nv">N_COLS</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span> <span class="nb">head</span> <span class="nt">-1</span> <span class="s2">"</span><span class="nv">$INP_FILE</span><span class="s2">"</span> | <span class="nb">wc</span> <span class="nt">-c</span> <span class="si">)</span><span class="s2">"</span>
<span class="c"># account for that</span>
<span class="o">((</span> N_COLS-- <span class="o">))</span>
</code></pre></div></div>

<p>With that done, I define a helper function that takes a file and calculates each columns' sum (actually, it counts the number of lines that have a 1 at that place).
I use <code class="highlighter-rouge">cut</code> to only look at that specific column.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>count_set_bits <span class="o">{</span>
    <span class="c"># count set bits at each position</span>
    <span class="nv">set_bit_counts</span><span class="o">=()</span>

    <span class="k">for</span> <span class="o">((</span> <span class="nv">i</span><span class="o">=</span>1<span class="p">;</span> i &lt;<span class="o">=</span> N_COLS<span class="p">;</span> i++<span class="o">))</span><span class="p">;</span> <span class="k">do
        </span>set_bit_counts+<span class="o">=(</span><span class="s2">"</span><span class="si">$(</span> <span class="nb">cut</span> <span class="nt">-c</span> <span class="nv">$i</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | <span class="nb">grep </span>1 | <span class="nb">wc</span> <span class="nt">-l</span> <span class="si">)</span><span class="s2">"</span><span class="o">)</span>
    <span class="k">done</span>

    <span class="c"># "return" the bit count</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">set_bit_counts</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span>
<span class="o">}</span>
</code></pre></div></div>
<p>This will contain the number of rows that have 1 at those columns.</p>

<p>Now, part 1 is trivial:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>part1 <span class="o">{</span>
    <span class="nv">set_bit_counts</span><span class="o">=(</span><span class="si">$(</span> count_set_bits <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="si">)</span><span class="o">)</span>
    <span class="c"># use redirection to avoid filename</span>
    <span class="nv">n</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span> <span class="nb">wc</span> <span class="nt">-l</span> &lt; <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="si">)</span><span class="s2">"</span>

    <span class="nv">gamma</span><span class="o">=</span>0
    <span class="nv">epsilon</span><span class="o">=</span>0

    <span class="k">for</span> <span class="o">((</span> <span class="nv">i</span><span class="o">=</span>0<span class="p">;</span> i &lt; N_COLS<span class="p">;</span> i++ <span class="o">))</span><span class="p">;</span> <span class="k">do</span>
        <span class="o">((</span> set_bit_counts[i] <span class="o">&gt;</span> n - set_bit_counts[i] <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nv">majority_bit</span><span class="o">=</span>1 <span class="o">||</span> <span class="nv">majority_bit</span><span class="o">=</span>0

        <span class="o">((</span> gamma <span class="o">=</span> 2 <span class="k">*</span> gamma + majority_bit <span class="o">))</span>
        <span class="o">((</span> epsilon <span class="o">=</span> 2 <span class="k">*</span> epsilon + 1 - majority_bit <span class="o">))</span>
    <span class="k">done

    </span><span class="nb">echo</span> <span class="k">$((</span> gamma <span class="o">*</span> epsilon <span class="k">))</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 class="section-header pt-4" id="d03p2">Part 2</h2>
<p>For part 2, we need to continuously filter the list until only one remains. Since the core logic for calculating for Oxygen and Carbon Dioxide is the same, I'll only explain one here.</p>

<p>I'm going to use intermediate files again. This is definitely possible to do without files but this just makes it a little easier.</p>

<h3 class="pt-4">Basic setup</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">o2_candidates</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span> <span class="nb">cat</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="si">)</span><span class="s2">"</span>
<span class="nv">tmpfile</span><span class="o">=</span><span class="sb">`</span><span class="nb">mktemp</span><span class="sb">`</span>

<span class="c"># for keeping track of which bits we've already seen</span>
<span class="nv">cur_bit</span><span class="o">=</span>0
</code></pre></div></div>

<h3 class="pt-4">Counting current number of candidates</h3>
<p>Since the number of rows are changing at every step, we need to keep track of the current count. We also need to recalculate column sum at every step. The sum part is simple because of the function declared earlier (<code class="highlighter-rouge">count_set_bits</code>)</p>

<p>To get the count of candidates remaining, we can use <code class="highlighter-rouge">wc</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">wc</span> <span class="nt">-l</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$o2_candidates</span><span class="s2">"</span>
</code></pre></div></div>

<h3 class="pt-4">Filtering candidates</h3>
<p>The other part of the puzzle is only keeping lines that we want to. This can be achieved by <code class="highlighter-rouge">grep</code>. When we're looking at the <code class="highlighter-rouge">i</code>th column, the first <code class="highlighter-rouge">i-1</code> columns can be anything ("<code class="highlighter-rouge">.</code>" in regex). So, for example if I want my 6th character to be <code class="highlighter-rouge">Y</code> and don't care about anything else, I'll use the following regex:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"^.{5}Y"</span>
</code></pre></div></div>

<p>For this problem, filtering candidates looks like:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ignore for `cur_bit` characters (0 indexed so -1 offset not needed)</span>
<span class="c"># and then look for `set_bit`</span>
<span class="nv">o2_candidates</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span> <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"^.{</span><span class="nv">$cur_bit</span><span class="s2">}</span><span class="k">${</span><span class="nv">reqd_bit</span><span class="k">}</span><span class="s2">"</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$o2_candidates</span><span class="s2">"</span> <span class="si">)</span><span class="s2">"</span>
</code></pre></div></div>

<h3 class="pt-4">Base 2 to decimal</h3>
<p><code class="highlighter-rouge">bc</code> has a special variable called <code class="highlighter-rouge">ibase</code> that controls the <code class="highlighter-rouge">base</code> of <code class="highlighter-rouge">i</code>nput. In case you were wondering, <code class="highlighter-rouge">obase</code> also exists. So, we can do math in binary and get the result in decimal. For example, multiplying 10 (<code class="highlighter-rouge">1010</code> in binary) and 5 (<code class="highlighter-rouge">101</code> in binary):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bc <span class="o">&lt;&lt;&lt;</span> <span class="s2">"ibase=2; 1010 * 101"</span>
<span class="c"># Output:</span>
50
</code></pre></div></div>

<h3 class="pt-4">Full solution</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>part2 <span class="o">{</span>
    <span class="nv">o2_candidates</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span> <span class="nb">cat</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="si">)</span><span class="s2">"</span>
    <span class="nv">co2_candidates</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span> <span class="nb">cat</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="si">)</span><span class="s2">"</span>

    <span class="nv">tmpfile</span><span class="o">=</span><span class="sb">`</span><span class="nb">mktemp</span><span class="sb">`</span>

    <span class="nb">cp</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$tmpfile</span><span class="s2">"</span>
    <span class="nv">cur_bit</span><span class="o">=</span>0
    <span class="k">while</span> <span class="o">((</span> <span class="nv">n</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span> <span class="nb">wc</span> <span class="nt">-l</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$o2_candidates</span><span class="s2">"</span> <span class="si">)</span><span class="s2">"</span> <span class="o">))</span><span class="p">;</span> <span class="o">((</span> n <span class="o">&gt;</span> 1 <span class="o">))</span><span class="p">;</span> <span class="k">do
        </span><span class="nv">set_bit_counts</span><span class="o">=(</span><span class="si">$(</span> count_set_bits <span class="s2">"</span><span class="nv">$tmpfile</span><span class="s2">"</span> <span class="si">)</span><span class="o">)</span>

        <span class="c"># if number of 1s &gt;= number of 0s</span>
        <span class="o">((</span> set_bit_counts[cur_bit] <span class="o">&gt;=</span> n - set_bit_counts[cur_bit] <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nv">reqd_bit</span><span class="o">=</span>1 <span class="o">||</span> <span class="nv">reqd_bit</span><span class="o">=</span>0

        <span class="c"># ignore for `cur_bit` characters (0 indexed so -1 offset not needed)</span>
        <span class="c"># and then look for `reqd_bit`</span>
        <span class="nv">o2_candidates</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span> <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"^.{</span><span class="nv">$cur_bit</span><span class="s2">}</span><span class="k">${</span><span class="nv">reqd_bit</span><span class="k">}</span><span class="s2">"</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$o2_candidates</span><span class="s2">"</span> <span class="si">)</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$o2_candidates</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$tmpfile</span><span class="s2">"</span>

        <span class="o">((</span> cur_bit++ <span class="o">))</span>
    <span class="k">done</span>

    <span class="c"># reset variables</span>
    <span class="nv">cur_bit</span><span class="o">=</span>0
    <span class="nb">cp</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$tmpfile</span><span class="s2">"</span>
    <span class="k">while</span> <span class="o">((</span> <span class="nv">n</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span> <span class="nb">wc</span> <span class="nt">-l</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$co2_candidates</span><span class="s2">"</span> <span class="si">)</span><span class="s2">"</span> <span class="o">))</span><span class="p">;</span> <span class="o">((</span> n <span class="o">&gt;</span> 1 <span class="o">))</span><span class="p">;</span> <span class="k">do
        </span><span class="nv">set_bit_counts</span><span class="o">=(</span><span class="si">$(</span> count_set_bits <span class="s2">"</span><span class="nv">$tmpfile</span><span class="s2">"</span> <span class="si">)</span><span class="o">)</span>

        <span class="c"># if number of 0s &gt; number of 1s</span>
        <span class="o">((</span> n - set_bit_counts[cur_bit] <span class="o">&gt;</span> set_bit_counts[cur_bit] <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nv">reqd_bit</span><span class="o">=</span>1 <span class="o">||</span> <span class="nv">reqd_bit</span><span class="o">=</span>0

        <span class="nv">co2_candidates</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span> <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"^.{</span><span class="nv">$cur_bit</span><span class="s2">}</span><span class="k">${</span><span class="nv">reqd_bit</span><span class="k">}</span><span class="s2">"</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$co2_candidates</span><span class="s2">"</span> <span class="si">)</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$co2_candidates</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$tmpfile</span><span class="s2">"</span>

        <span class="o">((</span> cur_bit++ <span class="o">))</span>
    <span class="k">done

    </span><span class="nb">echo</span> <span class="s2">"ibase=2; </span><span class="nv">$o2_candidates</span><span class="s2"> * </span><span class="nv">$co2_candidates</span><span class="s2">"</span> | bc
    <span class="nb">rm</span> <span class="s2">"</span><span class="nv">$tmpfile</span><span class="s2">"</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="text-center py-4">· · ·</div>

<h1 class="section-header">Day 04</h1>

<h2 class="section-header pt-4" id="d04p2">Parts 1 and 2</h2>
<p>Ok, this is where things got really interesting. For solving this, we need to cover a variety of concepts. Let's tackle them one by one and build towards the solution.</p>

<h3 class="pt-4">Multi-dimensional arrays</h3>
<p>The bingo card is a 2D board. Bash natively doesn't support multiple dimensional arrays. Obviously we can map any N-d array to 1-d just by multiplying and adding indices but something better exists. Some other approaches can be found in <a href="https://stackoverflow.com/q/16487258" target="_blank" rel="noopener">this SO question</a>.</p>

<p>I used the associative array approach. Basically, it is like a hashmap (or <code class="highlighter-rouge">dict</code> in python, <code class="highlighter-rouge">Object</code> in js, etc) where the key is the index in the form <code class="highlighter-rouge">i,j</code> and the value is the element at <code class="highlighter-rouge">arr[i][j]</code>. Since we have multiple boards, I used 3 indices for this array: first for indexing the board and rest two for indexing inside the board.</p>

<p>To facilitate fast number processing, I also store a mapping of number to index. When lets say <code class="highlighter-rouge">82</code> is called, I'll just use this LUT and update those specific boards only rather than iterating over all boards and checking each cell for <code class="highlighter-rouge">82</code>.</p>

<p>Due to the requirements of this task, we need to keep track of which numbers have been marked. Some hack could've been arranged using negative numbers and adding one to everything but I chose to keep it simple and made another associative array, <code class="highlighter-rouge">bingo_cards_marked</code> that stores whether the number was marked or not.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># associative array</span>
<span class="c"># key: [card index, row, col]</span>
<span class="nb">declare</span> <span class="nt">-A</span> bingo_cards
<span class="nb">declare</span> <span class="nt">-A</span> bingo_cards_marked

<span class="k">function </span>read_input <span class="o">{</span>
    <span class="c"># read the list of random numbers</span>
    <span class="nv">IFS</span><span class="o">=</span>, <span class="nb">read</span> <span class="nt">-a</span> numbers &lt; &lt;<span class="o">(</span> <span class="nb">head</span> <span class="nt">-1</span> <span class="s2">"</span><span class="nv">$INP</span><span class="s2">"</span> <span class="o">)</span>

    <span class="nb">local </span><span class="nv">bingo_idx</span><span class="o">=</span>0 <span class="nv">line_idx</span><span class="o">=</span>0 line bingo_row col key

    <span class="k">while </span><span class="nb">read </span>line<span class="p">;</span> <span class="k">do</span>
        <span class="c"># input next bingo card after 5 lines</span>
        <span class="k">if</span> <span class="o">((</span> line_idx <span class="o">==</span> 5 <span class="o">))</span><span class="p">;</span> <span class="k">then
            </span><span class="nv">line_idx</span><span class="o">=</span>0
            <span class="o">((</span> bingo_idx++ <span class="o">))</span>
        <span class="k">fi

        </span><span class="nb">read</span> <span class="nt">-a</span> bingo_row <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>
        <span class="k">for </span>col <span class="k">in</span> <span class="si">$(</span> <span class="nb">seq </span>0 <span class="k">$((</span> BINGO_COLS <span class="o">-</span> <span class="m">1</span> <span class="k">))</span> <span class="si">)</span><span class="p">;</span> <span class="k">do
            </span><span class="nv">key</span><span class="o">=</span><span class="s2">"</span><span class="nv">$bingo_idx</span><span class="s2">,</span><span class="nv">$line_idx</span><span class="s2">,</span><span class="nv">$col</span><span class="s2">"</span>
            bingo_cards[<span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">]=</span><span class="k">${</span><span class="nv">bingo_row</span><span class="p">[</span><span class="nv">$col</span><span class="p">]</span><span class="k">}</span>
            <span class="c"># all numbers are unmarked in the beginning</span>
            bingo_cards_marked[<span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">]=</span>0

            <span class="c"># store indices separated by space</span>
            num2idx[<span class="k">${</span><span class="nv">bingo_cards</span><span class="p">[</span><span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="p">]</span><span class="k">}</span><span class="o">]=</span><span class="s2">"</span><span class="si">$(</span> <span class="nb">echo</span> <span class="k">${</span><span class="nv">num2idx</span><span class="p">[</span><span class="k">${</span><span class="nv">bingo_cards</span><span class="p">[</span><span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="p">]</span><span class="k">}</span><span class="p">]</span><span class="k">}</span> <span class="nv">$key</span> <span class="si">)</span><span class="s2">"</span>
        <span class="k">done</span>

        <span class="o">((</span> line_idx++ <span class="o">))</span>
        <span class="c">#   this skips empty lines</span>
        <span class="c">#   vvvvvvvvvvvvvvvvvvvv</span>
    <span class="k">done</span> &lt; &lt;<span class="o">(</span><span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'^$'</span> <span class="s2">"</span><span class="nv">$INP</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'2,$p'</span><span class="o">)</span>
    <span class="c">#                              ^^^^^^^^^^^^^</span>
    <span class="c">#                              since first line has random number list</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 class="pt-4">Checking for bingo</h3>
<p>This was another piece of the puzzle which is going to be used repeatedly so the logic best resides inside a function. Given an index of a bingo card as argument, this goes over the rows and columns and checks whether atleast a single cell was unmarked. If nothing was unmarked, it returns 0 otherwise, it returns 1.</p>

<p>In bash, the <code class="highlighter-rouge">return</code> keyword in functions isn't what you expect it to be. As seen in the earlier problems, to really "return" from a function, we print it. In bash, the return keyword does two things:</p>
<ol>
  <li><strong>stop execution of the function</strong>: even if you're inside a loop, you'll get out of the function</li>
  <li><strong>set the status code</strong>: a status code of 0 means success and anything else means failure. <code class="highlighter-rouge">if</code> and <code class="highlighter-rouge">test</code> use this definition</li>
</ol>

<p><a href="https://stackoverflow.com/a/4419956" target="_blank" rel="noopener">This SO answer</a> explains this in more detail.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>bingo_done <span class="o">{</span>
    <span class="c"># receives an index of bingo to check from bingo card list</span>

    <span class="nb">local </span>bingo_dimen found_invalid_row found_invalid_col row_wise_key col_wise_key i j
    <span class="nv">bingo_dimen</span><span class="o">=</span><span class="nv">$BINGO_ROWS</span>

    <span class="k">for </span>i <span class="k">in</span> <span class="si">$(</span> <span class="nb">seq </span>0 <span class="k">$((</span> bingo_dimen <span class="o">-</span> <span class="m">1</span> <span class="k">))</span> <span class="si">)</span><span class="p">;</span> <span class="k">do
        </span><span class="nv">found_invalid_row</span><span class="o">=</span>0
        <span class="nv">found_invalid_col</span><span class="o">=</span>0

        <span class="k">for </span>j <span class="k">in</span> <span class="si">$(</span> <span class="nb">seq </span>0 <span class="k">$((</span> bingo_dimen <span class="o">-</span> <span class="m">1</span> <span class="k">))</span> <span class="si">)</span><span class="p">;</span> <span class="k">do
            </span><span class="nv">row_wise_key</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">,</span><span class="nv">$i</span><span class="s2">,</span><span class="nv">$j</span><span class="s2">"</span>
            <span class="nv">col_wise_key</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">,</span><span class="nv">$j</span><span class="s2">,</span><span class="nv">$i</span><span class="s2">"</span>

            <span class="o">((</span> bingo_cards_marked[<span class="s2">"</span><span class="nv">$row_wise_key</span><span class="s2">"</span><span class="o">]</span> <span class="o">==</span> 0 <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nv">found_invalid_row</span><span class="o">=</span>1
            <span class="o">((</span> bingo_cards_marked[<span class="s2">"</span><span class="nv">$col_wise_key</span><span class="s2">"</span><span class="o">]</span> <span class="o">==</span> 0 <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nv">found_invalid_col</span><span class="o">=</span>1
        <span class="k">done</span>

        <span class="c"># either didnt find invalid row or didnt find invalid col</span>
        <span class="o">((</span> found_invalid_row <span class="k">*</span> found_invalid_col <span class="o">==</span> 0 <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="k">return </span>0
    <span class="k">done

    return </span>1
<span class="o">}</span>
</code></pre></div></div>

<p>I also need to keep track of which bingo cards have won. The reason is twofold:</p>
<ol>
  <li>We don't mark new numbers on a card that has already won</li>
  <li>It is needed in the way I'm solving this problem, to make sure that in every iteration I don't double count a card.</li>
</ol>

<p>For this and for the solution to the problem itself, I'm using an array that stores <code class="highlighter-rouge">card_number,score</code> pairs in the order the cards won.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># list of bingo cards that were finished</span>
<span class="c"># in order and their score</span>
<span class="nb">declare</span> <span class="nt">-a</span> win_order_and_score

<span class="k">function </span>bingo_win_recorded <span class="o">{</span>
    <span class="c"># checks whether the card had already won</span>
    <span class="nb">local </span>idx score winner

    <span class="k">for </span>winner <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">win_order_and_score</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
        </span><span class="nv">IFS</span><span class="o">=</span>, <span class="nb">read </span>idx score <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$winner</span><span class="s2">"</span>
        <span class="o">((</span> idx <span class="o">==</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="k">return </span>0
    <span class="k">done</span>

    <span class="c"># $? will be 1, if statements will fail etc</span>
    <span class="k">return </span>1
<span class="o">}</span>
</code></pre></div></div>

<p>Now, we come to the actual bingo game. Since we're storing all the indices for each number, we just need to iterate over them, mark the number and check whether its a bingo in the subset of all cards.</p>

<p>Going into a little more depth in my solution here, <code class="highlighter-rouge">num2idx</code> stores a space separated list of indices. For example if the number <code class="highlighter-rouge">82</code> was present in cards 4, 9 and 13 at the top left, top right and bottom left corners respectively, <code class="highlighter-rouge">num2idx[82]</code> would look like <code class="highlighter-rouge">3,0,0 8,0,4 12,4,0</code>. Note the space between comma separated 3-tuples. The -1 is due to 0-indexing.</p>

<p>We've already seen that we can use <code class="highlighter-rouge">cut</code> to separate out the individual items but here, we'll have to change the delimiter to a newline first. Instead, we use <code class="highlighter-rouge">awk</code>. Now <code class="highlighter-rouge">awk</code>, like <code class="highlighter-rouge">cut</code> also assumes that the different "rows" are in individual lines but we can change that using <code class="highlighter-rouge">RS</code> (record separator).</p>

<p>So, to extract just the card index, we can do something like:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">awk</span> <span class="nt">-vRS</span><span class="o">=</span><span class="s1">' '</span> <span class="nt">-F</span>, <span class="s1">'{ print $1 }'</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"3,0,0 8,0,4 12,4,0"</span>
<span class="c"># Output:</span>
3
8
12
</code></pre></div></div>

<p>Basics aside, this is how I go through the cards for which the number was called just now</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>check_bingo_list <span class="o">{</span>
    <span class="c"># receives an array of $bingo_idx,$line_idx,$col (basically whatever is stored in num2idx)</span>
    <span class="nv">bingo_idx_to_check</span><span class="o">=(</span><span class="si">$(</span> <span class="nb">awk</span> <span class="nt">-vRS</span><span class="o">=</span><span class="s1">' '</span> <span class="nt">-F</span>, <span class="s1">'{ print $1 }'</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="si">)</span><span class="o">)</span>

    <span class="nv">bingo_found</span><span class="o">=()</span>

    <span class="k">for </span>idx <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">bingo_idx_to_check</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do</span>
        <span class="c">#                    we dont want to add same card again</span>
        <span class="c">#                    vvvvvvvvvvvvvvvvvvvvvvvvv</span>
        bingo_done <span class="s2">"</span><span class="nv">$idx</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> bingo_win_recorded <span class="nv">$idx</span> <span class="o">&amp;&amp;</span> bingo_found+<span class="o">=(</span><span class="nv">$idx</span><span class="o">)</span>
    <span class="k">done

    </span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">bingo_found</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span>
<span class="o">}</span>
</code></pre></div></div>

<p>With all the pieces in place, we can now simulate the bingo game:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>simulate_game <span class="o">{</span>
    read_input

    <span class="c"># loop over the list of random numbers</span>
    <span class="k">for </span>n <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">numbers</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do</span>
        <span class="c"># update all bingo card values using `num2idx`</span>
        <span class="k">for </span>idx <span class="k">in</span> <span class="k">${</span><span class="nv">num2idx</span><span class="p">[</span><span class="nv">$n</span><span class="p">]</span><span class="k">}</span><span class="p">;</span> <span class="k">do
            </span><span class="nv">IFS</span><span class="o">=</span>, <span class="nb">read </span>bingo_card _unused _unused <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$idx</span><span class="s2">"</span>
            <span class="c"># dont mark new numbers if card has already won</span>
            bingo_win_recorded <span class="nv">$bingo_card</span> <span class="o">||</span> bingo_cards_marked[<span class="s2">"</span><span class="nv">$idx</span><span class="s2">"</span><span class="o">]=</span>1
        <span class="k">done</span>

        <span class="c"># check if new bingo</span>
        <span class="c"># check_bingo_list already filters for old winners</span>
        <span class="nv">bingo_found_idxs</span><span class="o">=(</span><span class="si">$(</span> check_bingo_list <span class="s2">"</span><span class="k">${</span><span class="nv">num2idx</span><span class="p">[</span><span class="nv">$n</span><span class="p">]</span><span class="k">}</span><span class="s2">"</span> <span class="si">)</span><span class="o">)</span>

        <span class="c"># calculate and store score</span>
        <span class="k">for </span>idx <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">bingo_found_idxs</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
            </span><span class="nb">sum</span><span class="o">=</span>0
            <span class="k">for </span>row <span class="k">in</span> <span class="si">$(</span> <span class="nb">seq </span>0 <span class="k">$((</span> BINGO_ROWS <span class="o">-</span> <span class="m">1</span> <span class="k">))</span> <span class="si">)</span><span class="p">;</span> <span class="k">do
                for </span>col <span class="k">in</span> <span class="si">$(</span> <span class="nb">seq </span>0 <span class="k">$((</span> BINGO_COLS <span class="o">-</span> <span class="m">1</span> <span class="k">))</span> <span class="si">)</span><span class="p">;</span> <span class="k">do
                    </span><span class="nv">key</span><span class="o">=</span><span class="s2">"</span><span class="nv">$idx</span><span class="s2">,</span><span class="nv">$row</span><span class="s2">,</span><span class="nv">$col</span><span class="s2">"</span>
                    <span class="o">((</span> bingo_cards_marked[<span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">]</span> <span class="o">==</span> 0 <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="o">((</span> <span class="nb">sum</span> +<span class="o">=</span> bingo_cards[<span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">]</span> <span class="o">))</span>
                <span class="k">done
            done

            </span>win_order_and_score+<span class="o">=(</span><span class="s2">"</span><span class="nv">$idx</span><span class="s2">,</span><span class="k">$((</span> n<span class="o">*</span><span class="nb">sum</span> <span class="k">))</span><span class="s2">"</span><span class="o">)</span>
        <span class="k">done
    done</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now, we have the order in which boards won and their score stored in <code class="highlighter-rouge">win_order_and_score</code>. To solve parts 1 and 2, we just need to check the first and last element after calling the function:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>simulate_game

<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">win_order_and_score</span><span class="p">[0]</span><span class="k">}</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">win_order_and_score</span><span class="p">[-1]</span><span class="k">}</span><span class="s2">"</span>
<span class="c"># Output:</span>
88,10374
68,24742
</code></pre></div></div>

<p>While we can ignore the bingo card index, I want to see just the answers, like for other days. We can use parameter substitution:</p>
<blockquote class="blockquote"><a href="https://tldp.org/LDP/abs/html/parameter-substitution.html" target="_blank" rel="noopener">${var#Pattern}, ${var##Pattern}</a>
<p>
${var#Pattern}<br />
&nbsp;&nbsp;&nbsp;&nbsp;Remove from $var the <i>shortest</i> part of $Pattern that matches the <i>front end</i> of $var.
</p>
<p>
${var##Pattern}<br />
&nbsp;&nbsp;&nbsp;&nbsp;Remove from $var the <i>longest</i> part of $Pattern that matches the <i>front end</i> of $var.
</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>simulate_game

<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">win_order_and_score</span><span class="p">[0]##*,</span><span class="k">}</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">win_order_and_score</span><span class="p">[-1]##*,</span><span class="k">}</span><span class="s2">"</span>
<span class="c"># Output:</span>
10374
24742
</code></pre></div></div>

<div class="text-center py-4">· · ·</div>

<h1 class="section-header">Day 05</h1>

<h2 class="section-header pt-4" id="d05p1">Part 1</h2>
<p>The 2D array part should be clear, thanks to day 4's problem.</p>

<p>Since we can deal with a single delimiter using <code class="highlighter-rouge">read</code> and <code class="highlighter-rouge">IFS</code>, its better to convert the ` -&gt; ` to <code class="highlighter-rouge">,</code>. While reading the input, we'll also figure out the total number of rows and cols.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">N_ROW</span><span class="o">=</span>0
<span class="nv">N_COL</span><span class="o">=</span>0

<span class="nb">declare</span> <span class="nt">-a</span> input
<span class="nb">declare</span> <span class="nt">-A</span> grid

<span class="k">function </span>read_input <span class="o">{</span>
    <span class="c"># input is comma separated now</span>
    <span class="nv">input</span><span class="o">=(</span><span class="si">$(</span> <span class="nb">sed</span> <span class="s1">'s/ -&gt; /,/'</span> <span class="s2">"</span><span class="nv">$INP</span><span class="s2">"</span> <span class="si">)</span><span class="o">)</span>

    <span class="nb">local </span>line x1 y1 x2 y2

    <span class="k">for </span>line <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">input</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
        </span><span class="nv">IFS</span><span class="o">=</span>, <span class="nb">read </span>x1 y1 x2 y2 <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>

        <span class="o">((</span> x1 + 1 <span class="o">&gt;</span> N_COL <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nv">N_COL</span><span class="o">=</span><span class="k">$((</span> x1 <span class="o">+</span> <span class="m">1</span> <span class="k">))</span>
        <span class="o">((</span> x2 + 1 <span class="o">&gt;</span> N_COL <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nv">N_COL</span><span class="o">=</span><span class="k">$((</span> x2 <span class="o">+</span> <span class="m">1</span> <span class="k">))</span>
        <span class="o">((</span> y1 + 1 <span class="o">&gt;</span> N_ROW <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nv">N_ROW</span><span class="o">=</span><span class="k">$((</span> y1 <span class="o">+</span> <span class="m">1</span> <span class="k">))</span>
        <span class="o">((</span> y2 + 1 <span class="o">&gt;</span> N_ROW <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nv">N_ROW</span><span class="o">=</span><span class="k">$((</span> y2 <span class="o">+</span> <span class="m">1</span> <span class="k">))</span>
    <span class="k">done</span>
<span class="o">}</span>
</code></pre></div></div>

<p>A helper function to initialize the associative array (sets all values to 0):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>init_grid <span class="o">{</span>
    <span class="nb">local </span>i j key

    <span class="k">for</span> <span class="o">((</span> <span class="nv">i</span><span class="o">=</span>0<span class="p">;</span> i &lt; N_ROW<span class="p">;</span> i++ <span class="o">))</span><span class="p">;</span> <span class="k">do
        for</span> <span class="o">((</span> <span class="nv">j</span><span class="o">=</span>0<span class="p">;</span> j &lt; N_COL<span class="p">;</span> j++ <span class="o">))</span><span class="p">;</span> <span class="k">do
            </span><span class="nv">key</span><span class="o">=</span><span class="s2">"</span><span class="nv">$i</span><span class="s2">,</span><span class="nv">$j</span><span class="s2">"</span>
            grid[<span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">]=</span>0
        <span class="k">done
    done</span>
<span class="o">}</span>
</code></pre></div></div>

<p>For looping through the coordinates, we can use <code class="highlighter-rouge">seq</code>. <code class="highlighter-rouge">seq</code> takes an "increment" parameter that we can set to <code class="highlighter-rouge">-1</code> for the descending values.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">seq </span>5 <span class="nt">-1</span> 2
<span class="c"># Output:</span>
5
4
3
2
</code></pre></div></div>

<p>Rest of part 1 is simple:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>straight_lines <span class="o">{</span>
    <span class="nb">local </span>i j key line x1 y1 x2 y2 increment x y n_dangerous

    <span class="k">for </span>line <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">input</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
        </span><span class="nv">IFS</span><span class="o">=</span>, <span class="nb">read </span>x1 y1 x2 y2 <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>
        <span class="c"># y doesn't change</span>
        <span class="c"># seq on x</span>
        <span class="k">if</span> <span class="o">((</span> y1 <span class="o">==</span> y2 <span class="o">))</span><span class="p">;</span> <span class="k">then
            </span><span class="nv">y</span><span class="o">=</span><span class="nv">$y1</span>
            <span class="o">((</span> x1 <span class="o">&gt;</span> x2 <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nv">increment</span><span class="o">=</span><span class="nt">-1</span> <span class="o">||</span> <span class="nv">increment</span><span class="o">=</span>1
            <span class="k">for </span>x <span class="k">in</span> <span class="si">$(</span> <span class="nb">seq</span> <span class="s2">"</span><span class="nv">$x1</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$increment</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$x2</span><span class="s2">"</span> <span class="si">)</span><span class="p">;</span> <span class="k">do
                </span><span class="nv">key</span><span class="o">=</span><span class="s2">"</span><span class="nv">$y</span><span class="s2">,</span><span class="nv">$x</span><span class="s2">"</span>
                grid[<span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">]=</span><span class="k">$((</span> grid[<span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">]</span> <span class="o">+</span> <span class="m">1</span> <span class="k">))</span>
            <span class="k">done</span>
        <span class="c"># x doesn't change</span>
        <span class="c"># seq on y</span>
        <span class="k">elif</span> <span class="o">((</span> x1 <span class="o">==</span> x2 <span class="o">))</span><span class="p">;</span> <span class="k">then
            </span><span class="nv">x</span><span class="o">=</span><span class="nv">$x1</span>
            <span class="o">((</span> y1 <span class="o">&gt;</span> y2 <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nv">increment</span><span class="o">=</span><span class="nt">-1</span> <span class="o">||</span> <span class="nv">increment</span><span class="o">=</span>1
            <span class="k">for </span>y <span class="k">in</span> <span class="si">$(</span> <span class="nb">seq</span> <span class="s2">"</span><span class="nv">$y1</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$increment</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$y2</span><span class="s2">"</span> <span class="si">)</span><span class="p">;</span> <span class="k">do
                </span><span class="nv">key</span><span class="o">=</span><span class="s2">"</span><span class="nv">$y</span><span class="s2">,</span><span class="nv">$x</span><span class="s2">"</span>
                grid[<span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">]=</span><span class="k">$((</span> grid[<span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">]</span> <span class="o">+</span> <span class="m">1</span> <span class="k">))</span>
            <span class="k">done
        fi
    done

    </span><span class="nv">n_dangerous</span><span class="o">=</span>0

    <span class="k">for</span> <span class="o">((</span> <span class="nv">i</span><span class="o">=</span>0<span class="p">;</span> i &lt; N_ROW<span class="p">;</span> i++ <span class="o">))</span><span class="p">;</span> <span class="k">do
        for</span> <span class="o">((</span> <span class="nv">j</span><span class="o">=</span>0<span class="p">;</span> j &lt; N_COL<span class="p">;</span> j++ <span class="o">))</span><span class="p">;</span> <span class="k">do
            </span><span class="nv">key</span><span class="o">=</span><span class="s2">"</span><span class="nv">$i</span><span class="s2">,</span><span class="nv">$j</span><span class="s2">"</span>
            <span class="o">((</span> grid[<span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">]</span> <span class="o">&gt;</span> 1 <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="o">((</span> n_dangerous++ <span class="o">))</span>
        <span class="k">done
    done

    </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$n_dangerous</span><span class="s2">"</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 class="section-header pt-4" id="d05p2">Part 2</h2>
<p>Since the second part asks for all the lines (both straight and diagonal), we can use the same grid after part 1 and just add the diagonal values to it.</p>

<p>Since both <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code> are changing now, we'll need two <code class="highlighter-rouge">seq</code>s. Their outputs can be merged using <code class="highlighter-rouge">paste</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>diagonal_lines <span class="o">{</span>
    <span class="nb">local </span>i j key line x1 y1 x2 y2 x_inc y_inc x y n_dangerous

    <span class="k">for </span>line <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">input</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
        </span><span class="nv">IFS</span><span class="o">=</span>, <span class="nb">read </span>x1 y1 x2 y2 <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>
        <span class="o">((</span> x1 <span class="o">&gt;</span> x2 <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nv">x_inc</span><span class="o">=</span><span class="nt">-1</span> <span class="o">||</span> <span class="nv">x_inc</span><span class="o">=</span>1
        <span class="o">((</span> y1 <span class="o">&gt;</span> y2 <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nv">y_inc</span><span class="o">=</span><span class="nt">-1</span> <span class="o">||</span> <span class="nv">y_inc</span><span class="o">=</span>1

        <span class="c"># skip straight lines</span>
        <span class="o">((</span> x1 <span class="o">==</span> x2 <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="k">continue</span>
        <span class="o">((</span> y1 <span class="o">==</span> y2 <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="k">continue

        while </span><span class="nb">read </span>coords<span class="p">;</span> <span class="k">do
            </span><span class="nv">IFS</span><span class="o">=</span>, <span class="nb">read </span>x y <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$coords</span><span class="s2">"</span>
            <span class="nv">key</span><span class="o">=</span><span class="s2">"</span><span class="nv">$y</span><span class="s2">,</span><span class="nv">$x</span><span class="s2">"</span>
            grid[<span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">]=</span><span class="k">$((</span> grid[<span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">]</span> <span class="o">+</span> <span class="m">1</span> <span class="k">))</span>
        <span class="k">done</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="si">$(</span> <span class="nb">paste</span> <span class="nt">-d</span>, &lt;<span class="o">(</span> <span class="nb">seq</span> <span class="s2">"</span><span class="nv">$x1</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$x_inc</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$x2</span><span class="s2">"</span> <span class="o">)</span> &lt;<span class="o">(</span> <span class="nb">seq</span> <span class="s2">"</span><span class="nv">$y1</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$y_inc</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$y2</span><span class="s2">"</span> <span class="o">)</span> <span class="si">)</span><span class="s2">"</span>
    <span class="k">done

    </span><span class="nv">n_dangerous</span><span class="o">=</span>0

    <span class="k">for</span> <span class="o">((</span> <span class="nv">i</span><span class="o">=</span>0<span class="p">;</span> i &lt; N_ROW<span class="p">;</span> i++ <span class="o">))</span><span class="p">;</span> <span class="k">do
        for</span> <span class="o">((</span> <span class="nv">j</span><span class="o">=</span>0<span class="p">;</span> j &lt; N_COL<span class="p">;</span> j++ <span class="o">))</span><span class="p">;</span> <span class="k">do
            </span><span class="nv">key</span><span class="o">=</span><span class="s2">"</span><span class="nv">$i</span><span class="s2">,</span><span class="nv">$j</span><span class="s2">"</span>
            <span class="o">((</span> grid[<span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span><span class="o">]</span> <span class="o">&gt;</span> 1 <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="o">((</span> n_dangerous++ <span class="o">))</span>
        <span class="k">done
    done

    </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$n_dangerous</span><span class="s2">"</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="text-center py-4">· · ·</div>

<h1 class="section-header"></h1>

<p>My solutions, for both <code class="highlighter-rouge">bash</code> and very little <code class="highlighter-rouge">rust</code> can be found <a href="https://github.com/yoogottamk/aoc-2021" target="_blank" rel="noopener">here</a>.</p>


  <div class="suggested row">
    
    <div class="col-md-4 col-sm-12"
      style="background-image: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 1)), url(/assets/images/posts/split-path.webp);">
      <a class="prev stretched-link" href="/blog/port-based-routing"></a>
      <span class="post-title">&laquo; Port based routing</span>
    </div>
    

    
  </div>

  <script src="https://utteranc.es/client.js"
      repo="yoogottamk/yoogottamk.github.io"
      issue-term="pathname"
      theme="github-dark"
      crossorigin="anonymous"
      async>
  </script>
</div>

  </div>

  <link rel="stylesheet" href="/css/footer.css">

<footer class="footer fixed-bottom">
  <div class="container d-flex flex-row justify-content-between">
    <span class="d-flex align-items-center">Yoogottam Khandelwal</span>
    <span>
      <ul class="list-unstyled list-group list-group-horizontal">
        
          <li class="icon-li"><a href="https://github.com/yoogottamk/" target="_blank" rel="noopener"><i class="fa fa-github"></i></a></li>
        
          <li class="icon-li"><a href="https://www.linkedin.com/in/yoogottamk/" target="_blank" rel="noopener"><i class="fa fa-linkedin-square"></i></a></li>
        
          <li class="icon-li"><a href="https://www.facebook.com/yoogottamk" target="_blank" rel="noopener"><i class="fa fa-facebook"></i></a></li>
        
          <li class="icon-li"><a href="mailto:yoogottamk@outlook.com" target="_blank" rel="noopener"><i class="fa fa-envelope"></i></a></li>
        
      </ul>
    </span>
  </div>

  <div class="container credits w-100 text-right">
    
    
  </div>
</footer>


  <!-- included at the end of body, as all script files should -->

<script
  src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"
  integrity="sha512-bnIvzh6FU75ZKxp0GXLH9bewza/OIw6dLVh9ICg0gogclmYGguQJWl8U30WpbsGTqbIiAwxTsbe76DErLq5EDQ=="
  crossorigin="anonymous"></script>

<script
  src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
  integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
  crossorigin="anonymous"></script>

<script
  src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
  integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
  crossorigin="anonymous"></script>

<script src="/js/copy-code.js"></script>
<script src="/js/link-hover.js"></script>

</body>
</html>
